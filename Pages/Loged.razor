@page "/loged"
@inject FetchService FetchService
@inject ISessionStorageService sessionStorage
@inject IDispatcher Dispatcher
@using Checker.Models
@using Checker.Services
@using Checker.state

<PageTitle>loged</PageTitle>

<h1>You are loged</h1>

<div class="col-md-6">
    <button type="button" class="btn btn-secondary btn-block" @onclick="@(() => getAll())">get</button>
</div>

@code {
    private async Task<string> GetToken()
    {
        string retrievedToken = await sessionStorage.GetItemAsync("authToken");
        return retrievedToken;
    }

    private async void getAll()
    {
        try
        {
            var token = await GetToken();
            var response = await FetchService.GetRespons("https://backend.gabrielchiorcea.tech/get", token);
            var profileCardModel = new ProfileCardModel
            {
                HomeAddress = "response.HomeAddress",
                Country = response.Country,
                County = response.County,
                Occupation = response.Occupation,
                Image = response.Image
            };
            Dispatcher.Dispatch(new ProfileCardState(
                profileCardModel.HomeAddress,
                profileCardModel.Country,
                profileCardModel.County,
                profileCardModel.Occupation,
                profileCardModel.Image
            ));
        }
        catch (Exception ex)
        {
            Console.WriteLine(ex);
        }
    }
}